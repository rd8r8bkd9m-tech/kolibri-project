# Kolibri OS - Makefile

.PHONY: all build archiver test clean help

help:
	@echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
	@echo "‚ïë          KOLIBRI OS - TARGETS                          ‚ïë"
	@echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
	@echo ""
	@echo "make build       - –ö–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë"
	@echo "make archiver    - –ö–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤–∞—Ç–æ—Ä"
	@echo "make test        - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤–∞—Ç–æ—Ä"
	@echo "make clean       - –£–¥–∞–ª–∏—Ç—å binaries"
	@echo "make help        - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"
	@echo ""

all: build archiver test

build:
	@echo "üî® –ö–æ–º–ø–∏–ª–∏—Ä—É—é –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã..."
	@mkdir -p build-test
	@cd tests && for f in test_*.c; do \
		echo "  –ö–æ–º–ø–∏–ª–∏—Ä—É—é $$f..."; \
		gcc -O2 -I../backend/include -o ../build-test/$${f%.c} $$f -lm -Wl,-rpath,@loader_path/../lib 2>/dev/null || true; \
	done
	@echo "‚úÖ –ì–æ—Ç–æ–≤–æ"

archiver:
	@echo "üéØ –ö–æ–º–ø–∏–ª–∏—Ä—É—é –∞—Ä—Ö–∏–≤–∞—Ç–æ—Ä..."
	@mkdir -p tools
	@gcc -O2 -o tools/kolibri-archive tools/kolibri_archiver.c
	@echo "‚úÖ tools/kolibri-archive –≥–æ—Ç–æ–≤"
	@ls -lh tools/kolibri-archive

test: archiver
	@echo "üß™ –¢–µ—Å—Ç–∏—Ä—É—é –∞—Ä—Ö–∏–≤–∞—Ç–æ—Ä..."
	@bash test_archiver.sh

clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	@rm -rf build-test/test_* build-test/*.dSYM
	@rm -f tools/kolibri-archive
	@rm -f /tmp/test*.kolibri /tmp/large.txt /tmp/readme_restored.md
	@echo "‚úÖ –û—á–∏—â–µ–Ω–æ"
