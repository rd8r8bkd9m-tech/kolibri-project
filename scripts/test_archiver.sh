#!/bin/bash
# ğŸ¯ Kolibri Archiver - Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     KOLIBRI OS ARCHIVER - Ğ‘Ğ«Ğ¡Ğ¢Ğ Ğ«Ğ™ Ğ¡Ğ¢ĞĞ Ğ¢               â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo

ARCHIVER="./tools/kolibri-archive"

if [ ! -f "$ARCHIVER" ]; then
    echo "âŒ ĞÑ€Ñ…Ğ¸Ğ²Ğ°Ñ‚Ğ¾Ñ€ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. ĞšĞ¾Ğ¼Ğ¿Ğ¸Ğ»Ğ¸Ñ€ÑƒÑ..."
    gcc -O2 -o "$ARCHIVER" tools/kolibri_archiver.c
    echo "âœ… Ğ¡ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾"
    echo
fi

# Ğ¢ĞµÑÑ‚ 1: ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ» (README.md)
echo "ğŸ“‹ Ğ¢ĞµÑÑ‚ 1: ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
$ARCHIVER compress README.md /tmp/test1.kolibri
echo

# Ğ¢ĞµÑÑ‚ 2: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸
echo "ğŸ“Š Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± Ğ°Ñ€Ñ…Ğ¸Ğ²Ğµ:"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
$ARCHIVER info /tmp/test1.kolibri
echo

# Ğ¢ĞµÑÑ‚ 3: Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
echo "ğŸ”“ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
$ARCHIVER extract /tmp/test1.kolibri /tmp/readme_restored.md
echo

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹
echo "ğŸ“ˆ Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ²:"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ORIG=$(stat -f%z README.md 2>/dev/null || stat -c%s README.md 2>/dev/null)
ARCH=$(stat -f%z /tmp/test1.kolibri 2>/dev/null || stat -c%s /tmp/test1.kolibri 2>/dev/null)
RATIO=$(echo "scale=2; $ORIG / $ARCH" | bc)

echo "ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»:  $ORIG Ğ±Ğ°Ğ¹Ñ‚"
echo "ĞÑ€Ñ…Ğ¸Ğ²:     $ARCH Ğ±Ğ°Ğ¹Ñ‚"
echo "Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ:    ${RATIO}x"
echo

# Ğ¢ĞµÑÑ‚ 4: Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ ÑĞ¸Ğ½Ñ‚ĞµÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ»
echo "ğŸ”§ Ğ¢ĞµÑÑ‚ 2: ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ° (10 MB)"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
head -c 10485760 /dev/zero | tr '\0' 'X' > /tmp/large.txt
echo "Ğ¤Ğ°Ğ¹Ğ» ÑĞ¾Ğ·Ğ´Ğ°Ğ½ (10 MB)"

time $ARCHIVER compress /tmp/large.txt /tmp/test2.kolibri
echo

$ARCHIVER info /tmp/test2.kolibri
echo

# ĞÑ‡Ğ¸ÑÑ‚ĞºĞ°
echo "ğŸ§¹ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
rm -f /tmp/test1.kolibri /tmp/test2.kolibri /tmp/large.txt /tmp/readme_restored.md
echo "âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!"
